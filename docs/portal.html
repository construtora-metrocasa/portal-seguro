<!DOCTYPE html>
<html>
<head>
<style>
body{margin:0;background:#0f0f0f;color:white;font-family:Arial;}
header{display:flex;justify-content:space-between;padding:15px 30px;background:#141414;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:20px;padding:30px;}
.card{background:#1f1f1f;padding:25px;border-radius:16px;cursor:pointer;transition:.3s;}
.card:hover{transform:scale(1.08);background:#2a2a2a;}
.popup{position:fixed;bottom:20px;right:20px;background:#222;padding:12px 18px;border-radius:8px;}
</style>
</head>

<body>

<header>
  <div>ðŸŽ¬ Portal</div>
  <div id="userInfo"></div>
  <button onclick="logout()">Sair</button>
</header>

<div class="grid" id="cards"></div>

<script>
const API="https://script.google.com/macros/s/SEU_ID/exec";

let user=sessionStorage.getItem("user");
let sites=JSON.parse(sessionStorage.getItem("sites")||"[]");
let sessionMinutes=sessionStorage.getItem("sessionMinutes");

if(!user) location.href="index.html";

userInfo.innerText=`ðŸ‘¤ ${user} â± ${sessionMinutes} min`;

sites.forEach(s=>{
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`<h3>${s.site}</h3>`;
  div.onclick=()=>openSite(s.token,s.site);
  cards.appendChild(div);
});

function openSite(token,site){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"log",user,site})
  });
  location.href="viewer.html?token="+token;
}

function logout(){
  sessionStorage.clear();
  location.href="index.html";
}

let lastUser="";
setInterval(()=>{
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"lastAccess"})
  })
  .then(r=>r.json())
  .then(data=>{
    if(!data) return;
    if(data.user!=lastUser){
      lastUser=data.user;
      showPopup(`${data.user} acessou ${data.site}`);
    }
  });
},5000);

function showPopup(msg){
  const d=document.createElement("div");
  d.className="popup";
  d.innerText=msg;
  document.body.appendChild(d);
  setTimeout(()=>d.remove(),4000);
}
</script>
</body>
</html>
